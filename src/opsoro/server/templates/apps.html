{% extends "site_base.html" %}

{% block body_class %}apps{% endblock %}

{% block app_body %}
	<section class="apps">
		<div class="">
			{% if apps %}
				<div class="apps-available">
					{% for category in apps|sort %}
						<div id="{{ category[3:] }}" class="app-category row small-up-3 medium-up-5 large-up-8">
							<h3>{{ category[3:] }}</h3>
							{% for app in apps[category] %}
								{{ app_macro(app) }}
							{% endfor %}
						</div>
					{% endfor %}
					<div class="app-category row small-up-3 medium-up-5 large-up-8">
						{% if other_apps %}
							<h3>Other apps</h3>
							{% for app in other_apps %}
								{{ app_macro(app) }}
							{% endfor %}
						{% endif %}
					</div>
				</div>
			{% else %}
				<h2>{{ _('No apps available.') }}</h2>
			{% endif %}
		</div>
	</section>

{% endblock %}

{% block app_toolbar %}{% endblock %}

{% block sidebar_left %}{% endblock %}
{% block sidebar_right %}{% endblock %}

{% block app_modals %}{% endblock %}

{% block app_scripts %}
	<script>
		var $apps = $('.app-container');
		var $categories = $('.app-category');

		$('#search').keyup(function() {
			var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
			$apps.show().filter(function() {
				var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
				return !~text.indexOf(val);
			}).hide();
			$categories.show().filter(function() {
				var all_apps = $(this).find(".app-container").length;
				var invis_apps = $(this).find(".app-container[style='display: none;']").length;
				var vis_apps = all_apps - invis_apps
				return vis_apps < 1;
			}).hide();
		});
	</script>
{% endblock %}


{% macro app_macro(app) -%}
	{% set app_enabled = ((online and app.connection == 2) or app.connection < 2) %}
	{% set app_background = app.color if app_enabled else 'dark_gray' %}
	{% set app_href = '/app/open/' + app.formatted_name if app_enabled else '#' %}
	{% set app_class = app.formatted_name + ('' if app_enabled else ' disabled') %}

	<div class="app-container float-left column column-block {{ app_class }}">
		<a href="{{ app_href }}">
			<div class="app-button background_{{ app_background }}">
				<div class="app-banner">
					{% if app.active %}<div class="fa-cog fa-spin"></div>{% endif %}
					{% if not online and app.connection == 2 %}<div class="app-beat fa-wifi"></div>{% endif %}

				</div>
				<div class="app-icon {{ app.icon }}"></div>
			</div>
			<div class="app-label">{{ app.full_name }}</div>
			{% for tag in app.tags %}
				<div class="app-tag hide">{{ tag }}</div>
			{% endfor %}
		</a>
	</div>
	{{enabled}}
{%- endmacro %}
